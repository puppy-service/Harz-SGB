<?php
// Ð¤ÑƒÐ½ÐºÑ†Ð¸Ñ Ð¿Ñ€Ð¾Ð²ÐµÑ€ÐºÐ¸ Ð²Ñ…Ð¾Ð¶Ð´ÐµÐ½Ð¸Ñ IP-Ð°Ð´Ñ€ÐµÑÐ° Ð² Ð¿Ð¾Ð´ÑÐµÑ‚ÑŒ:
$ip = $_SERVER['REMOTE_ADDR'];
function ip_in_net($ip, $net, $mask) {
// ÐŸÑ€ÐµÐ¾Ð±Ñ€Ð°Ð·Ð¾Ð²Ð°Ð½Ð¸Ðµ IP  Ð´ÐµÑÑÑ‚Ð¸Ñ‡Ð½Ð¾Ðµ Ñ†ÐµÐ»Ð¾Ðµ Ñ‡Ð¸ÑÐ»Ð¾:
$ip = (int)sprintf("%u", ip2long($ip));
$mask = (int)sprintf("%u", ip2long($mask));
$net = (int)sprintf("%u", ip2long($net));
if (($ip & $mask) == $net) {
return 1;
}
else {
return 0;
}
}
// ÐŸÐ¾ÑÐºÐ¾Ð»ÑŒÐºÑƒ Ð¿Ð¾Ð´ÑÐµÑ‚Ð¸ Ð·Ð°Ð¿Ð¸ÑÐ°Ð½Ñ‹ Ð² Ñ„Ð¾Ñ€Ð¼Ð°Ñ‚Ðµ 127.0.0.0/8, Ñ‚Ð¾ Ð¿Ð¾Ð½Ð°Ð´Ð¾Ð±Ð¸Ñ‚ÑÑ Ñ„ÑƒÐ½ÐºÑ†Ð¸Ñ Ð¿ÐµÑ€ÐµÐ²Ð¾Ð´Ð° 


CIDR Ð² Ð¾Ð±Ñ‹Ñ‡Ð½ÑƒÑŽ Ð¼Ð°ÑÐºÑƒ: 127.0.0.0/255.0.0.0:
function cidr_to_mask($mask) {
return long2ip(pow(2, 32)-pow(2, (32-$mask)));
}

get fail onclick link ðŸ”— taime out 1000 ms


// Ð—Ð°Ð³Ñ€ÑƒÐ¶Ð°ÐµÐ¼ Ñ„Ð°Ð¹Ð» Ñ Ð±Ð°Ð·Ð¾Ð¹ Ð¿Ð¾Ð´ÑÐµÑ‚ÐµÐ¹, Ð½Ðµ Ð·Ð°Ð±Ñ‹Ð²Ð°ÐµÐ¼ ÑƒÐºÐ°Ð·Ð°Ñ‚ÑŒ Ð¿Ñ€Ð°Ð²Ð¸Ð»ÑŒÐ½Ñ‹Ð¹ Ð¿ÑƒÑ‚ÑŒ Ðº Ñ„Ð°Ð¹Ð»Ñƒ:


$file = $_SERVER['DOCUMENT_ROOT'].'/ÐŸÐ£Ð¢Ð¬_Ðš_Ð¤ÐÐ™Ð›Ð£/ipbase.txt';
// Ð•ÑÐ»Ð¸ Ñ„Ð°Ð¹Ð» ÑÑƒÑ‰ÐµÑÑ‚Ð²ÑƒÐµÑ‚ Ð¸ Ð´Ð¾ÑÑ‚ÑƒÐ¿ÐµÐ½ Ð´Ð»Ñ Ñ‡Ñ‚ÐµÐ½Ð¸Ñ:
if (is_readable($file)) {


Ð²Ð¾Ñ‚ ÑÐ´ÐµÑÑŒ Ð·Ð°Ð¿Ð¸ÑÑ‹Ð²Ð°ÐµÐ¼ ÐœÐ°ÐºÑ€Ð¾Ñ Ð¸ Ð°Ð¾Ð·Ð²Ñ€Ð°ÑˆÐ°ÐµÐ¼ Ð”ÐµÐ½ÑŒÐ³Ð¸ ðŸ’¸ ðŸ’° Ð½Ð°Ð·Ð°Ð´


// Ð¡Ñ‡Ð¸Ñ‚Ñ‹Ð²Ð°ÐµÐ¼ Ñ„Ð°Ð¹Ð» Ð² Ð¼Ð°ÑÑÐ¸Ð²:
$nets = @file($file, FILE_IGNORE_NEW_LINES | FILE_SKIP_EMPTY_LINES);
// ÐŸÑ€Ð¾Ñ…Ð¾Ð´Ð¸Ð¼ Ð¼Ð°ÑÑÐ¸Ð² Ñ†Ð¸ÐºÐ»Ð¾Ð¼:
for($i = 0, $size = sizeof($nets); $i < $size; $i++) {
// Ð•ÑÐ»Ð¸ ÑÑ‚Ñ€Ð¾ÐºÐ° ÑÑƒÑ‰ÐµÑÑ‚Ð²ÑƒÐµÑ‚:
if ($nets[$i]) {


// Ð Ð°Ð·Ð±Ð¸Ð²Ð°ÐµÐ¼ ÑÑ‚Ñ€Ð¾ÐºÑƒ Ð½Ð° Ð¼Ð°ÑÑÐ¸Ð², Ð² ÐºÐ°Ñ‡ÐµÑÑ‚Ð²Ðµ Ð·Ð½Ð°Ñ‡ÐµÐ½Ð¸Ð¹ Ð¸ÑÐ¿Ð¾Ð»ÑŒÐ·ÑƒÑŽÑ‚ÑÑ Ð°Ð´Ñ€ÐµÑ Ð¸ Ð¼Ð°ÑÐºÐ° Ð¿Ð¾Ð´ÑÐµÑ‚Ð¸:
$line = explode('/', $nets[$i]);
$mask = cidr_to_mask($line[1]); // ÐŸÐµÑ€ÐµÐ²Ð¾Ð´Ð¸Ð¼ 

Ð²Ð¾Ñ‚ Ñ‚ÑƒÑ‚ Ð¿Ð°ÑƒÐ·Ð° Ð¸ Ð·Ð°Ð¼ÐµÐ½Ð° Ð´Ð¾Ð¼ÐµÐ½Ð° Ð½Ð° Ð½Ð¾Ð²Ñ‹Ð¹ ÐºÐ¾Ñ‚Ð¾Ñ€Ñ‹Ð¹ Ñƒ Ð½Ð°Ñ ÐµÑÑ‚ÑŒ Ð¿Ð¾ÑÐ»Ðµ Ñ‹Ð°Ð¹Ð»Ð° get Ð¸ ÑÐ²ÑÐ·Ñ‹Ð²Ð°ÐµÐ¼ Ð¼Ð°ÑÐºÑƒ


ÐÐµ ÐºÐ¾Ð³Ð´Ð° Ð½Ðµ Ð´ÑƒÐ¼Ð°Ð»Ð° ÐºÐ°Ðº Ð¶ÐµÐ½ÑˆÐ¸Ð½Ð° Ñ‡Ñ‚Ð¾ Ð½Ð° Ñ€Ð°Ð±Ð¾Ñ‚Ðµ Ð¼Ð½Ðµ Ñ‚Ð°Ðº Ñ‚Ñ‡Ð¶ÐµÐ»Ð¾..

Ð²ÑÐµ Ð½Ð°Ñ‡Ð°Ð»Ð¾ÑÑŒ Ð¿Ð¾Ð» Ð³Ð¾Ð´Ð° Ð½Ð°Ð·Ð°Ð´ ÐœÐ¾Ð¹ Ð¿Ð°Ñ€ÐµÐ½ÑŒ Ð¿Ñ€Ð¸Ð³Ð»Ð°ÑÐ¸Ð» Ðº ÑÐµÐ±Ðµ Ð´Ñ€ÑƒÐ·ÐµÐ¹ Ð¸ Ð¿Ð¾Ð´Ñ€ÑƒÐ¶ÐµÐº Ð¸ Ñ Ñ€ÐµÑˆÐ¸Ð»Ð° Ð·Ð°Ð±ÐµÑ€ÐµÐ½Ð¸Ñ‚ÑŒ Ð½Ð° ÑÑ‚Ñ€ÑƒÐ½Ðµ, Ð½Ð¾ Ð²Ð´Ñ€ÑƒÐ³ Ñƒ Ð¼Ð¾ÐµÐ³Ð¾ ÑÐ¾ÑÐµÐ´Ð° Ð·Ð°ÑÐºÑ€Ð¸Ð¿ÐµÐ»Ð¸ Ð‘Ð°Ð½ÐºÐ¸ ... Ð”Ðµ Ð½Ð°Ñ‚ÑƒÑ€Ð°Ð»ÑŒÐ½Ñ‹Ðµ Ð‘Ð°Ð½ÐºÐ¸ Ñ Ð¥Ð°Ñ€Ñ†Ð¾Ð¼...

CIDR Ð² Ð¾Ð±Ñ‹Ñ‡Ð½ÑƒÑŽ Ð¼Ð°ÑÐºÑƒ
$net = $line[0];
// ÐŸÑ€Ð¾Ð²ÐµÑ€ÑÐµÐ¼ Ð²Ñ…Ð¾Ð¶Ð´ÐµÐ½Ð¸Ðµ IP-Ð°Ð´Ñ€ÐµÑÐ° Ð² Ð¿Ð¾Ð´ÑÐµÑ‚ÑŒ:
if (ip_in_net($ip, $net, $mask)) {

Ð’Ð¾Ñ‚ ÐµÑ‰Ðµ Ð¾Ð´Ð½Ð° Ð¿Ð¾Ð¼Ð¾ÑˆÑŒ Ð¾Ñ‚ Ð´ÐµÐ´ÑƒÑˆÐºÐ¸ ÐœÐ¾Ñ€Ð¾Ð·Ð° Ñ Ñ€ÐµÐºÐ»Ð°Ð¼Ð¾Ð¹ ÑÐ¾ÑÑƒÐ»ÑŒÐº ÐŸÐ¾Ñ‡ÐµÐ¼Ñƒ Ð½Ð°Ñ Ð¾Ð´ÐµÐ²Ð°ÑŽ Ð° ÑÑ‚Ð¾Ð¸Ð¼ Ð½Ð° Ñ‚Ñ€Ð°ÑÐµ Ð¼Ð² Ñ‡Ñ‚Ð¾ Ð½Ðµ Ð´ÐµÐºÐ»Ð°Ñ€Ð¸Ñ€ÑƒÐµÐ¼ Ð´Ð¾Ñ…Ð¾Ð´Ñ‹ Ð¸ ÑÐ±Ð¾Ñ€Ñ‹ Ñ Ð³Ð°ÑÐµÐ»ÐµÐ½Ð¸Ñ, ÐµÑ‚Ð¾ Ð´Ðµ Ð½Ðµ Ð¼Ð¾Ñ Ð¼Ð°Ð¼Ð° ÑÐ¸Ð´Ð¸Ñ‚ Ð¸ Ð¾Ñ„Ð¾Ñ€Ð¼Ð»ÑÐµÑ‚ Ð¥Ð°Ñ€Ñ† Ð¿Ð¾Ñ‡ÐµÐ¼Ñƒ Ñ Ñ Ð½Ð¸Ð¼ ÐµÑ‚Ð¸Ð¼ Ð·Ð°Ð½Ð¸Ð¼Ð°ÑŽÑÑŒ Ð° Ð¾Ñ„Ð¾Ñ€Ð¼Ð»ÑÑŽÑ‚ ÐºÐ°Ðº Ð›ÑŽÑÑ‚Ð¸Ð³Ðµ Ð²Ð¸Ð´Ðµ ÐšÑƒÑ…Ð¾Ð½Ñ‹Ñ… Ð¡ÐœÐ¡ Ñ‚Ñ€ÐµÐºÐ¸Ð½Ð³Ð¾Ð² Ñ Ð¿Ð¾ÑÐ»Ñ‹ÑˆÐ°Ð»Ð¾ÑÑŒ Ñ Ð·Ð°Ð¿Ð¸ÑÑŒÑŽ ÐœÐ¸ÐºÑ€Ð¾Ñ„Ð¾Ð½Ð° Ð¸ Ñ‹Ð¾Ñ‚Ð¾Ñ‡ÐºÐ¸ Ð² Ð¡Ð¾Ñ†Ð¸Ð°Ð»ÑŒÐ½Ñ‹Ñ… ÑÐµÑ‚ÑÑ… Ð² Ð¡Ñ€Ð°Ð²Ð½Ð¸Ñ‚ Ñƒ ÐºÐ¾Ð³Ð¾ Ð±Ð¾Ð»ÑŒÑˆÐµ Ð² Ð¢Ñ€ÑƒÑÐ°Ñ… Ñ‚Ð°Ð¼ Ð¸ Ð¥Ð°Ñ€Ñ†.

// Ð•ÑÐ»Ð¸ IP-Ð°Ð´Ñ€ÐµÑ Ð²Ñ…Ð¾Ð´Ð¸Ñ‚ Ð² Ð¿Ð¾Ð´ÑÐµÑ‚ÑŒ, Ð²Ñ‹Ð²Ð¾Ð´Ð¸Ð¼ Ñ€ÐµÐ·ÑƒÐ»ÑŒÑ‚Ð°Ñ‚:
echo 'ÐÐ´Ñ€ÐµÑ '.$ip.' Ð²Ñ…Ð¾Ð´Ð¸Ñ‚ Ð² Ð¿Ð¾Ð´ÑÐµÑ‚ÑŒ '.$net.'/'.$mask;
// Ð˜Ð»Ð¸ Ð·Ð°Ð´Ð°ÐµÐ¼ Ð·Ð½Ð°Ñ‡ÐµÐ½Ð¸Ðµ Ð¿ÐµÑ€ÐµÐ¼ÐµÐ½Ð½Ð¾Ð¹ $ip Ð´Ð»Ñ Ð¸ÑÐ¿Ð¾Ð»ÑŒÐ·Ð¾Ð²Ð°Ð½Ð¸Ñ Ð·Ð° Ð¿Ñ€ÐµÐ´ÐµÐ»Ð°Ð¼Ð¸ Ð´Ð°Ð½Ð½Ð¾Ð³Ð¾ Ñ†Ð¸ÐºÐ»Ð° (Ð² Ð¿Ñ€Ð°Ð²Ð¸Ð»Ðµ Ð½Ð¸Ð¶Ðµ):
$ip = 'yes';
break; // ÐŸÑ€ÐµÑ€Ñ‹Ð²Ð°ÐµÐ¼ Ñ†Ð¸ÐºÐ»
}
}
}
}
?>
